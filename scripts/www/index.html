<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>åˆ‡æ°§è®¡ç®— Pro Mobile</title>
	<style>
		:root {
			--primary: #3498db;
			--success: #2ecc71;
			--warning: #f39c12;
			--danger: #e74c3c;
			--bg: #f5f7fa;
			--card: #ffffff;
			--dark-blue: #2c3e50;
		}

		* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
		body { background-color: var(--bg); font-family: -apple-system, sans-serif; padding-bottom: 130px; }

		.header { background: var(--dark-blue); color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 100; }
		.header h1 { font-size: 1.1rem; letter-spacing: 1px; }

		.container { padding: 12px; max-width: 600px; margin: 0 auto; }

		/* é…ç½®æŠ˜å  */
		details { background: var(--card); border-radius: 8px; margin-bottom: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
		summary { padding: 12px; font-size: 0.9rem; font-weight: bold; color: var(--primary); list-style: none; display: flex; justify-content: space-between; cursor: pointer; }
		.config-grid { padding: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; border-top: 1px solid #f0f0f0; }
		.config-item label { display: block; font-size: 0.7rem; color: #7f8c8d; margin-bottom: 3px; }
		.config-item input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.85rem; }

		/* æ•°æ®å¡ç‰‡ */
		.data-card { background: var(--card); border-radius: 12px; margin-bottom: 15px; padding: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border-left: 4px solid var(--primary); position: relative; }
		.data-card.manual-mode { border-left-color: var(--warning); }
		
		.card-header { display: flex; justify-content: space-between; margin-bottom: 15px; align-items: center; }
		.mode-btn { padding: 5px 12px; border-radius: 20px; border: none; font-size: 0.75rem; font-weight: bold; color: white; }
		.mode-auto { background: var(--primary); }
		.mode-manual { background: var(--warning); }

		.grid-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
		.field label { display: block; font-size: 0.75rem; color: #95a5a6; margin-bottom: 4px; }
		.edit-input { width: 100%; padding: 10px; border: 1px solid #dfe6e9; border-radius: 8px; font-size: 1rem; font-weight: bold; background: #fafafa; }
		
		.val { font-size: 1.1rem; font-weight: 800; color: #2d3436; font-family: 'Courier New', Courier, monospace; }
		.res-highlight { color: var(--primary); }
		.res-success { color: var(--success); }
		.res-steam { color: #9b59b6; }
		.res-total { color: #d35400; } /* æ€»é£é‡é¢œè‰² */

		/* Toast æç¤º */
		#toast {
			position: fixed;
			bottom: 150px;
			left: 50%;
			transform: translateX(-50%);
			background: rgba(0, 0, 0, 0.8);
			color: white;
			padding: 10px 20px;
			border-radius: 25px;
			font-size: 0.85rem;
			z-index: 2000;
			display: none;
			white-space: nowrap;
		}

		/* åº•éƒ¨å¯¼èˆª */
		.bottom-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 10px 15px; display: flex; flex-direction: column; gap: 8px; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
		.btn-group { display: flex; gap: 8px; }
		.btn { flex: 1; padding: 12px; border: none; border-radius: 10px; color: white; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 5px; }
		.btn-calc { background: var(--primary); flex: 1.5; }
		.btn-add { background: var(--success); }
		.btn-reset { background: #95a5a6; }

		.footer-info { text-align: center; color: #7f8c8d; font-size: 0.75rem; line-height: 1.4; padding-top: 5px; border-top: 1px solid #f0f0f0; }

		@keyframes flash {
			0% { opacity: 0.5; }
			100% { opacity: 1; }
		}
		.flash-active { animation: flash 0.3s ease-out; }
	</style>
</head>
<body>

	<div class="header"><h1>åˆ‡æ°§å‚æ•°è®¡ç®—å™¨</h1></div>
	<div id="toast">æç¤ºå­—</div>

	<div class="container">
		<details>
			<summary>âš™ï¸ åŸºç¡€å‚æ•°è®¾ç½®</summary>
			<div class="config-grid">
				<div class="config-item"><label>é£é‡ç³»æ•°</label><input type="number" id="windPerHz" value="378"></div>
				<div class="config-item"><label>åŠ ç…¤ç³»æ•°</label><input type="number" id="coalPerHz" value="1300"></div>
				<div class="config-item"><label>åŠ ç…¤K1</label><input type="number" id="coalK1" value="1.05"></div>
				<div class="config-item"><label>åŠ ç…¤K2</label><input type="number" id="coalK2" value="0.0017"></div>
				<div class="config-item"><label>åŠ ç…¤K3</label><input type="number" id="coalK3" value="3.23"></div>
				<div class="config-item"><label>çº¯æ°§æµé‡</label><input type="number" id="pureO2Flow" value="10325"></div>
			</div>
		</details>

		<div id="cardContainer"></div>
	</div>

	<div class="bottom-bar">
		<div class="btn-group">
			<button class="btn btn-add" onclick="addRow('auto')">ï¼‹è‡ªåŠ¨</button>
			<button class="btn btn-add" onclick="addRow('manual')" style="background:var(--warning)">ï¼‹æ‰‹åŠ¨</button>
			<button class="btn btn-calc" onclick="calcAll()">âš¡ ç«‹å³è®¡ç®—</button>
			<button class="btn btn-reset" onclick="resetAll()">â†º é‡ç½®</button>
		</div>
		<div class="footer-info">
			è®¡ç®—æ•°æ®ä»…ä¾›å‚è€ƒ<br>åˆ¶ä½œäººï¼šåˆ˜é£
		</div>
	</div>

	<script>
		let tableData = [
			{ fan: 60, o2: 21, steamRatio: 0.3, manualTotalO2: 0, mode: 'auto' },
			{ fan: 40, o2: 40, steamRatio: 0.4, manualTotalO2: 0, mode: 'auto' }
		];

		function showToast(msg) {
			const toast = document.getElementById('toast');
			toast.innerText = msg;
			toast.style.display = 'block';
			setTimeout(() => { toast.style.display = 'none'; }, 2000);
		}

		function renderCards() {
			const container = document.getElementById('cardContainer');
			container.innerHTML = '';
			tableData.forEach((item, index) => {
				const isManual = item.mode === 'manual';
				const card = document.createElement('div');
				card.className = `data-card ${isManual ? 'manual-mode' : ''}`;
				card.innerHTML = `
					<div class="card-header">
						<button class="mode-btn mode-${item.mode}" onclick="toggleMode(${index})">
							${isManual ? 'æ¨¡å¼ï¼šæ‰‹åŠ¨' : 'æ¨¡å¼ï¼šè‡ªåŠ¨'}
						</button>
						<span style="font-size:1.2rem; color:#e74c3c" onclick="delRow(${index})">ğŸ—‘ï¸</span>
					</div>
					<div class="grid-layout">
						<div class="field">
							<label>${isManual ? 'è®¾å®šæ€»æ°§é‡' : 'é£æœºé¢‘ç‡(Hz)'}</label>
							<input type="number" class="edit-input" value="${isManual ? item.manualTotalO2 : item.fan}" 
								   onchange="updateData(${index}, '${isManual ? 'manualTotalO2' : 'fan'}', this.value)">
						</div>
						<div class="field">
							<label>ç›®æ ‡æ°§æµ“åº¦(%)</label>
							<input type="number" class="edit-input" value="${item.o2}" 
								   onchange="updateData(${index}, 'o2', this.value)" ${isManual ? 'disabled style="opacity:0.4"' : ''}>
						</div>
						<div class="field"><label>é£æœºé£é‡(mÂ³/h)</label><div class="val res-highlight" id="wind-${index}">-</div></div>
						<div class="field"><label>å…‘å…¥æ°§æ°”(mÂ³/h)</label><div class="val res-highlight" id="addO2-${index}">-</div></div>
						<div class="field"><label>åŠ ç…¤é¢‘ç‡(Hz)</label><div class="val res-success" id="coalFreq-${index}">-</div></div>
						<div class="field"><label>å®é™…åŠ ç…¤(kg/h)</label><div class="val res-success" id="coal-${index}">-</div></div>
						<div class="field">
							<label>è’¸æ±½æ¯”ä¾‹</label>
							<input type="number" step="0.01" class="edit-input" value="${item.steamRatio}" onchange="updateData(${index}, 'steamRatio', this.value)">
						</div>
						<div class="field"><label>è’¸æ±½é‡(kg/h)</label><div class="val res-steam" id="steam-${index}">-</div></div>
						
						<div class="field" style="grid-column: span 2; background: #fff9f0; padding: 10px; border-radius: 8px; margin-top: 5px;">
							<label style="color:#d35400; font-weight:bold;">ç‚‰å†…æ€»é£é‡ (mÂ³/h)</label>
							<div class="val res-total" id="totalWind-${index}" style="font-size:1.3rem">-</div>
							<p style="font-size:0.6rem; color:#999; margin-top:4px;">*æ€»é£é‡ = å…‘å…¥æ°§ + è’¸æ±½Ã—1.25 + é£æœºé£é‡</p>
						</div>

						<div class="field" style="grid-column: span 2; border-top: 1px solid #f0f0f0; padding-top: 8px;">
							<label>æ°§æ°”æ€»é…æ¯”%</label><div class="val" id="ratio-${index}" style="color:#e67e22; font-size:1.2rem">-</div>
						</div>
					</div>
				`;
				container.appendChild(card);
			});
			performCalculation(false);
		}

		function updateData(index, field, val) {
			tableData[index][field] = Number(val);
		}

		function toggleMode(index) {
			tableData[index].mode = tableData[index].mode === 'auto' ? 'manual' : 'auto';
			showToast(`åˆ‡æ¢è‡³${tableData[index].mode === 'manual' ? 'æ‰‹åŠ¨' : 'è‡ªåŠ¨'}`);
			renderCards();
		}

		function performCalculation(animate = true) {
			const cfg = {
				windPerHz: Number(document.getElementById('windPerHz').value),
				coalPerHz: Number(document.getElementById('coalPerHz').value),
				k1: Number(document.getElementById('coalK1').value),
				k2: Number(document.getElementById('coalK2').value),
				k3: Number(document.getElementById('coalK3').value),
				pureO2: Number(document.getElementById('pureO2Flow').value)
			};

			tableData.forEach((item, index) => {
				const wind = Math.round(item.fan * cfg.windPerHz);
				const windO2 = Math.round(wind * 0.21);
				let addO2 = 0, totalO2 = 0;

				if (item.mode === 'manual') {
					totalO2 = item.manualTotalO2;
					addO2 = Math.max(0, totalO2 - windO2);
				} else {
					if (item.fan === 0) { addO2 = cfg.pureO2; }
					else if (item.o2 > 21) { addO2 = Math.round((windO2 - wind * (item.o2/100)) / ((item.o2/100) - 1)); }
					totalO2 = windO2 + addO2;
				}

				const totalGas = wind + addO2;
				const effO2 = item.mode === 'manual' ? 
					(totalGas > 0 ? (totalO2/totalGas*100) : 100) : 
					item.o2;
				
				const coal = Math.round((cfg.k1 - cfg.k2 * effO2) * cfg.k3 * totalO2);
				const steam = Math.round(coal * item.steamRatio);
				
				// æ€»é£é‡è®¡ç®—å…¬å¼: å…‘å…¥æ°§æ°”é‡ + è’¸æ±½é‡ * 1.25 + é£æœºäº§ç”Ÿçš„é£é‡
				const totalWindCalculated = Math.round(addO2 + (steam * 1.25) + wind);
				
				const totalRatio = (totalO2 / ((steam/0.804) + totalGas) * 100).toFixed(2);

				const map = {
					[`wind-${index}`]: wind.toLocaleString(),
					[`addO2-${index}`]: addO2.toLocaleString(),
					[`coal-${index}`]: coal.toLocaleString(),
					[`coalFreq-${index}`]: (coal/cfg.coalPerHz).toFixed(2),
					[`steam-${index}`]: steam.toLocaleString(),
					[`totalWind-${index}`]: totalWindCalculated.toLocaleString(),
					[`ratio-${index}`]: totalRatio + '%'
				};

				for (let id in map) {
					const el = document.getElementById(id);
					if(el) {
						el.innerText = map[id];
						if(animate) { el.classList.remove('flash-active'); void el.offsetWidth; el.classList.add('flash-active'); }
					}
				}
			});
		}

		function calcAll() {
			performCalculation(true);
			showToast("âœ… è®¡ç®—å®Œæˆ");
		}

		function addRow(mode) {
			tableData.push({ fan: 40, o2: 21, steamRatio: 0.3, manualTotalO2: 10000, mode: mode });
			renderCards();
			showToast("â• å·²æ·»åŠ æ–°è¡Œ");
			window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
		}

		function delRow(index) {
			tableData.splice(index, 1);
			renderCards();
			showToast("ğŸ—‘ï¸ å·²åˆ é™¤");
		}

		function resetAll() {
			if(confirm("ç¡®å®šè¦é‡ç½®æ‰€æœ‰é…ç½®å—ï¼Ÿ")) location.reload();
		}

		document.addEventListener('DOMContentLoaded', renderCards);
	</script>
</body>
</html>